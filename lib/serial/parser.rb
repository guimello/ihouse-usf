################################################################################
module Serial
  ################################################################################
  class Parser
  
    ################################################################################
    attr_reader   :query, :key
    attr_accessor :message
    
    ################################################################################
    def initialize(options = {})
      @query = options[:query].match(/#(\w)+(!|\w)*#/).try(:to_s) || ''
      parse
    end  
    
    ################################################################################
    def parse
      @message  = @query.sub('P', '')
      @key      = @message.split('!')[0].sub('#', '')
    end

    ################################################################################
    # Pic will answer prepending 'P' to the key.
    def pic_answered?
      !!(@query.split('!')[0] =~ /P/)
    end

    ################################################################################
    private :parse
  end
end
