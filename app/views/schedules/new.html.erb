<% content_for :navigation do %>
  <% render :layout => 'layouts/main_navigation' do %>
    <%= render :partial => 'layouts/navigation/devices_item', :locals => {:classes => 'tab-separator', :house => @house, :user => @user} %>
    <%= render :partial => 'layouts/navigation/schedule_item',
      :locals => {:house => @house, :user => @user, :device => @device, :action => @action} %>
    <%= render :partial => 'layouts/navigation/add_edit_schedule_item',
        :locals => {:classes => 'selected tab-separator', :house => @house, :user => @user, :device => @device, :action => @action} %>
  <% end %>
<% end %>

<%= content_tag :h1, t(:add_edit_schedule, :scope => :schedule) %>
<%= content_tag :p, t(:add_edit_schedule, :scope => [:schedule, :hints]) %>

<% form_for @action, :url => user_house_device_action_schedules_url(@user, @house, @device, @action),
        :html => {:method => :post, :class => 'basic-form rounded large' } do |action_form| %>

        <%= error_messages_for :action, :associations => :schedules, :class => 'alert red error rounded-8' %>

        <% content_for :javascript do %>
          $(".add-new-schedule").live("click", function(){
            <%= "var schedule='#{generate_template(action_form, :schedules, :partial => "schedules/schedules_new_fieldset_form")}'" %>
        
            $("#div_clear_schedules").before(schedule.replace(/NEW_RECORD/g, new Date().getTime())).prev("div").highlightMe();
            $(".title-me").tipTip();

            return false;
          });

          $(".remove-new-schedule").live("click", function(){
            if(confirm($(this).confirmPlz()))
              $(this).closest("div").remove();

              return false;
            });

          $(".remove-existing-schedule").live("click", function(){
            if(confirm($(this).confirmPlz()))
            {
              $(this).closest("div").find(".remove-schedule-hidden").val(1);
              $(this).closest("div").hide();
            }

            return false;
          });   
          
        <% end %>
        
        <%= render :partial => "schedules/schedules_form", :locals => {:action_form => action_form,
                        :user => @user,
                        :house => @house,
                        :device => @device,
                        :action => @action} %>

        <%= awesome_submit_button t(:submit, :scope => :form), :tick %>
<% end %>

<% content_for :sidebar do %>
  <%= render :partial => "find_actions_sidebar", :locals =>{:user => @user, :house => @house, :device => @device} %>
  <%= required_fields_help %>
<% end %>
